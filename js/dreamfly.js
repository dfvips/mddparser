const rsaPrivateKey_0 = 'LS0tLS1CRUdJTiBSU0EgUFJJVkFURSBLRVktLS0tLQpNSUlFb3dJQkFBS0NBUUVBbVBKSEZycGVyL0Z3akp0dSs1amV4d25zM2VDeks2NkVka2pHT0hpY0hnYWdZVnpECjlYSzVrRzF0WVJ6S2hDS1pGWHkyVmJRL2RXZ2R3SDUwN2RTdUl4Ry9NT2JORDhIMWhZclNNZGY1ZlUvMkxEa1QKZ1pKeGgvNHM3QVBZeldyTTM1RFA2MHRtSklYQ0RiWlJibzF5VVFPMmZqblZRVGpneFM0dG1ITnA2clVMa3NlSwpXYVlycGRTb0lQYnRWdzlpdEt4czQvY3M3SEo1N0dGdVptdlZhL2V5UEVmdkpuS2dWcHkyckJSK3ZZWmhKNUhmCjJuMjBUYWY2dEdmc3dvMXpMdDNQZmNzV3E4SElVRGRJQjR2MmQ5R2ZRL2czY0xXTUoxbE1ZMlkwZmg1YXU1RW8KNC9XVEFQYzViWHhLUHBLVVZqRG91cjZYZ2hlYkNseGNvbDR0YndJREFRQUJBb0lCQURmM3dJZlNueituREZhSApzbThqRzdLZU1TMW9RbWhqcmxsU2ZDYkNDKzc0NGN0L0ZMNUd3eHpVemtmUkwxSjNEcW5NUHpUUmhyOUI0RkZHCmRTZHF3bVpXNGkzVTU0a3lvdFBCWHZXYVlOTzRaUTc5dStPWVlTOHdsZU92N0xBT3V2Vzhtamt5R0NpWlFjK2UKdmVIRXBPWjhnMVZoZUdZcm1DVFBweU80YURQWWgzcWVHWlJMUGtiVFB6L0N3Qmh4SzhYS2hYMlkrM3JiQjZpZQozNEZQN0h4R3h0MmFuWktEeUtBajEzOXk4WWRSL0JTUTRHR1JxVTJXWW5CVTRVcEpvRXlSUnNFUzRJdVNNMVhsCnFSY0w3ZW1iaGtnaUVRd2E5clBsL2Y2ZjNWWG95U1ordW5oWDdpMkZoWW41N1lYYW8zUlR5cU5vMGc5aTI5UFUKSGxlZ0x5RUNnWUVBemVwdVBQaEpHNSt5MkpIWUZ5MjB3MVFuRVZ4VEtXN1N4TnJWRjR4Z2kzRktEajM2b2F1QgowVm5NcE0vNldNMGhxcnZ1djlVeHpCY28vMlV5elhPaTc2VUovaHZTbXU0dUdXVUo3d0dEd0ZST0UveFl0Rk1VCmpUQkgxeDZITUVaOU1YN0ZSRSt5SXhMaXYzMkJleCs0T0I2NCt4SmZCSzViU3pWcHQ3Q1hrMmtDZ1lFQXZpV24KRTJtalp4Q0RUL3hvWXZnV2FMdlpySHc4TGlZQUxmUElFc205UW1CdjZFNmxKSVVuQzRqODBtVlBScnFUc0FLQQp1Sjc5Y0YyY2dlNUVkSVc3UFhlL3dicmFGZ0dSRERGaWJ0czhzd1FYOTBTM1F1cWFsU0NRWEJkdzlnVzhIUzdLCjVvZ25jVkxVckZQRnNuNU4zaGlGSEtmNU5ZYzdLQjFkaWVYRmx4Y0NnWUIvT3pEdVAwTjg3QW9ud3NYUVhJOXEKZVo3Q0hWZk5MQXJUVTV1RE4xdVlEV0lDdHMwY0E4cnN2aDJ5WUVlQmd3NGdYb3JBd1V4Sm5LM2FVSDg1YncvbwpId096blNGZVZYanFmQUhOU2hSTVRFc0tFa3dFNzZpdExIM1hMNmU4Ym5HQW1hSHQrWWhLSDZzM1FxYzBtbjdMClBrQng4Z0gvOUhPNFhzSjVtNFdzc1FLQmdFQ3ZvSG43S3dxSjFKSW1aUUNlTTBsbjluSTJSV2JScUtmNVVld0sKVTJjOFZYV3JJNFVjQXg5cWQ4Ky9oVXVqZDFDZVdWbjFSSFN3YytqRHZPZ0RBcUt6bFRsN3JtdGtGd3NWMWMydQpxYVNnMU9KYXJ4bUZwQmJ0WUE3a0xwcVRjdDVlcDhuck1iZmNuTnNQR0tkVFRud3F6VVhsWXVNeDRROFJobHUrCkhnejdBb0dCQUxRRFdKeWpZSndlbVNDUER4NFJXUG5ZbHhHdDNWYVZYaUhJL1FSZTI3SjJ5MWJjZFFrREVaODkKcjJRY3g3SjBMMEFJTzdDY1RtUmpKdFNvRmdVOWpxL3dBQjFpcWs2UG8wc2tvY2JhcGY1WHBFNG1Lbkx6dFlmdgpKT0pZR1V4dUgrZDRlN2NPQlVYYWFKSG11dmIvN3ZMSnd3WkRQU3NWSU85bEpTVGE4bWpDCi0tLS0tRU5EIFJTQSBQUklWQVRFIEtFWS0tLS0t',
rsaPrivateKey_1 = 'LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tCk1JSUV2UUlCQURBTkJna3Foa2lHOXcwQkFRRUZBQVNDQktjd2dnU2pBZ0VBQW9JQkFRQ1k4a2NXdWw2djhYQ00KbTI3N21ON0hDZXpkNExNcnJvUjJTTVk0ZUp3ZUJxQmhYTVAxY3JtUWJXMWhITXFFSXBrVmZMWlZ0RDkxYUIzQQpmblR0MUs0akViOHc1czBQd2ZXRml0SXgxL2w5VC9Zc09ST0JrbkdIL2l6c0E5ak5hc3pma00vclMyWWtoY0lOCnRsRnVqWEpSQTdaK09kVkJPT0RGTGkyWWMybnF0UXVTeDRwWnBpdWwxS2dnOXUxWEQySzByR3pqOXl6c2NubnMKWVc1bWE5VnI5N0k4Uis4bWNxQlduTGFzRkg2OWhtRW5rZC9hZmJSTnAvcTBaK3pDalhNdTNjOTl5eGFyd2NoUQpOMGdIaS9aMzBaOUQrRGR3dFl3bldVeGpaalIrSGxxN2tTamo5Wk1BOXpsdGZFbytrcFJXTU9pNnZwZUNGNXNLClhGeWlYaTF2QWdNQkFBRUNnZ0VBTi9mQWg5S2ZQNmNNVm9leWJ5TWJzcDR4TFdoQ2FHT3VXVko4SnNJTDd2amgKeTM4VXZrYkRITlRPUjlFdlVuY09xY3cvTk5HR3YwSGdVVVoxSjJyQ1psYmlMZFRuaVRLaTA4RmU5WnBnMDdobApEdjI3NDVoaEx6Q1Y0Ni9zc0E2NjlieWFPVElZS0psQno1Njk0Y1NrNW55RFZXRjRaaXVZSk0rbkk3aG9NOWlICmVwNFpsRXMrUnRNL1A4TEFHSEVyeGNxRmZaajdldHNIcUo3ZmdVL3NmRWJHM1pxZGtvUElvQ1BYZjNMeGgxSDgKRkpEZ1laR3BUWlppY0ZUaFNrbWdUSkZHd1JMZ2k1SXpWZVdwRnd2dDZadUdTQ0lSREJyMnMrWDkvcC9kVmVqSgpKbjY2ZUZmdUxZV0ZpZm50aGRxamRGUEtvMmpTRDJMYjA5UWVWNkF2SVFLQmdRRE42bTQ4K0VrYm43TFlrZGdYCkxiVERWQ2NSWEZNcGJ0TEUydFVYakdDTGNVb09QZnFocTRIUldjeWt6L3BZelNHcXUrNi8xVEhNRnlqL1pUTE4KYzZMdnBRbitHOUthN2k0WlpRbnZBWVBBVkU0VC9GaTBVeFNOTUVmWEhvY3dSbjB4ZnNWRVQ3SWpFdUsvZllGNwpIN2c0SHJqN0VsOEVybHRMTldtM3NKZVRhUUtCZ1FDK0phY1RhYU5uRUlOUC9HaGkrQlpvdTltc2ZEd3VKZ0F0Cjg4Z1N5YjFDWUcvb1RxVWtoU2NMaVB6U1pVOUd1cE93QW9DNG52MXdYWnlCN2tSMGhiczlkNy9CdXRvV0FaRU0KTVdKdTJ6eXpCQmYzUkxkQzZwcVZJSkJjRjNEMkJid2RMc3JtaUNkeFV0U3NVOFd5ZmszZUdJVWNwL2sxaHpzbwpIVjJKNWNXWEZ3S0JnSDg3TU80L1EzenNDaWZDeGRCY2oycDVuc0lkVjgwc0N0TlRtNE0zVzVnTllnSzJ6UndECnl1eStIYkpnUjRHRERpQmVpc0RCVEVtY3JkcFFmemx2RCtnZkE3T2RJVjVWZU9wOEFjMUtGRXhNU3dvU1RBVHYKcUswc2ZkY3ZwN3h1Y1lDWm9lMzVpRW9mcXpkQ3B6U2Fmc3MrUUhIeUFmLzBjN2hld25tYmhheXhBb0dBUUsrZwplZnNyQ29uVWtpWmxBSjR6U1dmMmNqWkZadEdvcC9sUjdBcFRaenhWZGFzamhSd0RIMnAzejcrRlM2TjNVSjVaCldmVkVkTEJ6Nk1PODZBTUNvck9WT1h1dWEyUVhDeFhWemE2cHBLRFU0bHF2R1lXa0Z1MWdEdVF1bXBOeTNsNm4KeWVzeHQ5eWMydzhZcDFOT2ZDck5SZVZpNHpIaER4R0dXNzRlRFBzQ2dZRUF0QU5ZbktOZ25CNlpJSThQSGhGWQorZGlYRWEzZFZwVmVJY2o5QkY3YnNuYkxWdHgxQ1FNUm56MnZaQnpIc25RdlFBZzdzSnhPWkdNbTFLZ1dCVDJPCnIvQUFIV0txVG8ralN5U2h4dHFsL2xla1RpWXFjdk8xaCs4azRsZ1pURzRmNTNoN3R3NEZSZHBva2VhNjl2L3UKOHNuREJrTTlLeFVnNzJVbEpOcnlhTUk9Ci0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS0=';
let listsize=0,arr = [],dl,isbreak = false,title,
privateKey = 'e1be6b4cf4021b3d181170d1879a530a9e4130b69032144d5568abfd6cd6c1c2',
headers = {'Accept-Language': 'en-CN;q=1, zh-Hans-CN;q=0.9','Content-Type': 'application/json;charset=UTF-8'},
appToken = '',//
deviceNum = '',
version = ''
isdownTry = false,
isNeedAlterVersion = false,
delay = (n) => new Promise(r => setTimeout(r,n)),
rsaPrivateKey = Math.ceil(Math.random() * 100) > 50 ? String.raw`${window.atob(rsaPrivateKey_0)}` : String.raw`${window.atob(rsaPrivateKey_1)}`;
// 下载单个
function downloadOne(info, tab,flag) {
	if (typeof flag === 'undefined'){
		dl = false;
	}else{
		dl = flag;
	}
	title = info.title;
	checkUrl(info.pageUrl,0);
}
// 下载多个
function downloadMul(info, tab) {
	dl = false;
	title = info.title;
	checkUrl(info.pageUrl,1);
}
// 修改appToken
function changeAppToken(){
	change('appToken');
}
// 修改deviceNum
function changeDeviceNum(){
	change('deviceNum');
}
//修改appVersion
function changeAppVersion(){
	change('appVersion');
}
//change
function change(name){
	let msg = window.prompt(`请输入${name}：`);
	while (msg === '') {
		msg = window.prompt(`请输入${name}：`);
	}
	if(msg !== null) {
		localStorage.setItem(`${name}`,msg);
	}
	if(name === 'appVersion') {
		version = msg;
	}
} 
// 检测网站
function checkUrl(url,mode){
	if(url.indexOf('mddcloud.com.cn/video/') !== -1){
		appToken = localStorage.getItem('appToken',),
		deviceNum = localStorage.getItem('deviceNum'),
		appVersion = localStorage.getItem('appVersion');
		function checkVersion (){
			if (appVersion === 'null' || appVersion === null) {
				appVersion = '4.4.12';
			}
			localStorage.setItem('appVersion',appVersion);
			version = appVersion;
			return true;
		}
		if((appToken === null || deviceNum === null || appVersion === null) || (appToken === 'null' || deviceNum === 'null' || appVersion === 'null')) {
			function checkUserMsg(msg,name) {
				if(msg === null || msg === '') {
					msg =	window.prompt(`请输入${name}：`);
					if (msg === null || msg === '') {
						var r=confirm("无登录信息，将无法解析无水印M3u8或完整视频，点击确定，表示不填写信息，点击取消，表示重新填写");
						if (r == true){
							return false;
						}else{
							checkUserMsg(msg,name);
						}
					}else {
						if (msg !== null && msg !== '') {
							localStorage.setItem(`${name}`,msg);
							return true;
						}else {
							checkUserMsg(msg,name);
						}
					}
				}
			}
			if(checkVersion()){
				let checkOne =  checkUserMsg(appToken,'appToken');
				if(checkOne) {
					checkUserMsg(deviceNum,'deviceNum');
					begin();
				}else {
					begin();
				}	
			}
		} else {
			if(checkVersion()) {
				begin();
			}
		}
		
		function begin () {
			arr=[];
			let pageid = url.match(/([a-f\d]{32}|[A-F\d]{32})/)[0],
			num = url.match(/(?<=.*?num=).*/)[0];
			startTask(pageid,num,mode);
		}
	}else{
		alert('请在埋堆堆播放页面使用本插件！')
	}
}
//开始判断
async function startTask (pageid,num,mode){
	isbreak = false;
	if(appToken === '' || appToken === 'null' || appToken === null) {
		appToken = getRandomid(64);
	}
	if(deviceNum === '' || appToken === 'null' || appToken === null) {
		deviceNum = getRandomid(32);
	}
	let tm = new Date().getTime(),
	sign = MD5(`os:Android|version:${version}|action:/api/vod/listVodSactions.action|time:${tm}|appToken:${appToken}|privateKey:${privateKey}|data:hasIntroduction=0&vodUuid=${pageid}&vod_type=0&`),
	reqBody = `{"time":${tm},"data":{"vodUuid":"${pageid}","hasIntroduction":0,"vod_type":0},"appToken":"${appToken}","os":"Android","version":"${version}","channel":"AppStore","sign":"${sign}"}`,
	listArr = await sendAxio('https://mob.mddcloud.com.cn/api/vod/listVodSactions.action',headers,'POST',JSON.parse(reqBody)),
	epList = JSON.parse(listArr).data,
	epCurrent = epList.filter(ep => ep.num == num);
	//判断下载模式
	if(mode === 0) {
		down(epCurrent);
	}else {
		down(epList);
	}
	//解析下载
	async function down(epList){ 
		isdownTry = false;
		let epFrees = epList.filter(ep => ep.isFreeLimit === 1 || ep.isVipSaction === 0),
		epVips = epList.filter(ep => ep.isFreeLimit === 0 && ep.isVipSaction === 1),
		epVipFirst = epVips.filter((ep,index) => index === 0),
		epVipNext = epVips.filter((ep,index) => index > 0),
		frees = await sortList(epFrees);
		vipFirst = await sortList(epVipFirst);
		vips = vipFirst;
		if (vips.length > 0 && Object.keys(vipFirst[0]).length !== 0 && vipFirst[0].url.indexOf('exper=360')=== -1){
			let vipNext = await sortList(epVipNext);
			vips = vips.concat(vipNext);
		}else {
			if(!dl){
				if(vips.length > 0 && vipFirst[0].url.indexOf('exper=360')!== -1) {
					var r = confirm("是否需要下载试看？");
					if (r == true){
						let vipNext = await sortList(epVipNext);
						vips = vips.concat(vipNext);
						isdownTry = true;
					}
				}else {
					let vipNext = await sortList(epVipNext);
					vips = vips.concat(vipNext);
				}
			}
		}
		let result = frees.concat(vips);
		startDown(result);
	}
	//遍历
	async function sortList(eps){
		let result = [];
		for(let episode of eps) {
			let uuid = episode.uuid,
			res = await parse(uuid),
			data = JSON.parse(res).data,
			obj = {};
			if(data != null) {
				if(typeof data.masterPlaylistUrl != 'undefined' ||typeof data.oriUrl != 'undefined') {
					if(typeof data.masterPlaylistUrl != 'undefined' ){
						let master = replaceHost(data.masterPlaylistUrl);
						if(typeof master !== 'undefined' && master !== '') {
							obj.url = master;
							obj.ua = calc(master);
							obj.name = data.name;
							obj.duration = data.duration;
						}
					}else {
						obj.url = data.oriUrl;
						obj.ua = calc(obj.url);
						obj.name = data.name;
						obj.duration = data.duration;
						obj.size = data.size;
					}
				}else {
					console.log(null);
				}
				if (Object.keys(obj).length === 0) {
					isbreak = true;
				}
			}else{
				isNeedAlterVersion = true;
				isbreak = true;
			}
			result.push(obj);
			if(eps.length > 1) {
				await delay(rahdomTime(600,1000));
			}
		}
		return result;
	}
	//接口请求	
	async function parse(vodId) { 
		if (!isbreak) {
			let tm = new Date().getTime(),
			sign = getSign(`os:Android|version:${version}|action:/api/vod/getSactionV2.action|time:${tm}|appToken:${appToken}|privateKey:${privateKey}|data:action=playUrl&checkVodTicket=1&sactionUuid=${vodId}&`),
			reqBody = `{"time":${tm},"data":{"checkVodTicket":1,"action":"playUrl","sactionUuid":"${vodId}"},"appToken":"${appToken}","os":"Android","version":"${version}","channel":"AppStore","deviceNum":"${deviceNum}","deviceType":0,"sign":"${sign}"}`,
			res = await sendAxio('https://mob.mddcloud.com.cn/api/vod/getSactionV2.action',headers,'POST',JSON.parse(reqBody));
			return res;
		} else {
			return {};
		}
	}
}
//获取清晰度
// function getUrl(data){
// 	let arr = ['fluHls','fourHls','fhdHls','hdHls','sdHls','oriUrl','tryUrl'],
// 	res = '';
// 	for (let hls of arr) {
// 		let url = data[hls];
// 		if(typeof url != 'undefined'){
// 			res = replaceHost(url)
// 			console.log(url,res);
// 			break;
// 		}
// 	}
// 	return res;
// }

//获取RSA签名Sign
function getSign(val) {
	let sig = new KJUR.crypto.Signature({'alg':'SHA256withRSA'});
	sig.init(rsaPrivateKey);
    sig.updateString(val);
    let sigHex = sig.sign();
    return btoa(String.fromCharCode.apply(null, sigHex.match(/.{2}/g).map(a=>"0x"+a)));
}

//开始下载任务
function startDown(arr){
	if(dl){
		let o = arr[0];
		if(o.url != undefined && o.ua != undefined && o.url.indexOf('m3u8') != -1) {
			content = btoa(unescape(encodeURIComponent(getConent(o))));
			window.open(`m3u8dl://${content}`);
		}else {
			alert('请填写appToken和deviceNum，如果已经填写，请升级VIP');
		}
	}else {
		let batContent = 'chcp 65001',
		zip = new JSZip(),
		batName = '',
		zipName = '';

		for (let o of arr) {
			if(o.url != undefined) {
				if(o.url.indexOf('m3u8') != -1) {
					batContent += '\r\n' + `N_m3u8DL-CLI ${getConent(o)}`;
				} else {
					let arr = [],
					m3 = `#EXTM3U\r\n#EXT-X-TARGETDURATION:15\r\n#EXT-X-DISCONTINUITY\r\n`;
					//非试看文件
					if(o.url.indexOf('exper=360')===-1){
						arr = spiltVideo(o.size,arr);
						for (let i = 0;i < arr.length;i++) {
							m3 += `#EXTINF:10,\r\n`;
							if (i === 0) {
								m3 += `#EXT-X-BYTERANGE:${arr[i]}@0\r\n`;
							}else if (i < arr.length-1) {
								m3 += `#EXT-X-BYTERANGE:10485760@${arr[i-1]}\r\n`;
							}else {
								m3 += `#EXT-X-BYTERANGE:${o.size - arr[i-1]}@${arr[i-1]}\r\n`;
							}
							m3 += `${o.url}\r\n`;
						}
						m3 += `#EXT-X-ENDLIST`;
						zip.file(`${o.name}.m3u8`, m3);
						o.url = `${o.name}.m3u8`;
						batContent += '\r\n' + `N_m3u8DL-CLI ${getConent(o)}`;
					}else {
						if(isdownTry) {
							m3 += `#EXTINF:${o.duration}\r\n`;
							m3 += `${o.url}\r\n`;
							m3 += `#EXT-X-ENDLIST`;
							zip.file(`${o.name}（试看）.m3u8`, m3);
							o.url = `${o.name}（试看）.m3u8`;
							batContent += '\r\n' + `N_m3u8DL-CLI ${getConent(o)}`;
						}
					}
				}
			}
		}
		
		if (batContent !== 'chcp 65001') {
			if(arr.length === 1) {
				title = arr[0].name;
			}
			if(title === undefined) {
				title = arr[0].name.replace(/\d+$/g,'');
			}
			if(batContent !== 'chcp 65001') {
				batName = `${title}.bat`;
				zip.file(batName, batContent);
			}
			zipName = `${title}.zip`;
			zip.generateAsync({type:'blob'}).then(function(content) {
				// see FileSaver.js
				saveAs(content, zipName);
			});
		} else {
			if (isNeedAlterVersion) {
				alert('请尝试修改AppVersion(手机App--我的--设置--关于(如：4.4.12))')
			}else {
				alert('请填写appToken和deviceNum，如果已经填写，请升级VIP');
			}
		}
	}
}
//下载
// function downloadFile (content,title){
// 	let i = new Blob([content], {
// 		type: 'text/plain'
// 	});
// 	let a = URL.createObjectURL(i);
// 	let o = title+'.bat';
// 	let r = document.createElement('a');
// 	r.href = a;
// 	r.download = o;
// 	r.style.display = 'none';
// 	let d;
// 	if (window.MouseEvent) {
// 		d = new MouseEvent('click')
// 	} else {
// 		d = document.createEvent('MouseEvents');
// 		d.initMouseEvent('click', true, false, window, 0, 0, 0, 0, 0, false, false, false, false, 0, null)
// 	}
// 	r.dispatchEvent(d);
// }
//生成命令
function getConent(o){
	let downPath = localStorage.getItem('savePath');
	if(downPath != null) {
		downPath = `--workDir "${path}"`;
	}else {
		downPath = '';
	}
	let content = `"${o.url}" --saveName "${o.name}" ${downPath} --headers "User-Agent:${o.ua}" --enableDelAfterDone --enableBinaryMerge `;
	return content;
}
//替换域名
function replaceHost(s) {
	let regex = /(https?:\/\/)[^\/]+/g;
	return s.replace(regex, 'http://wxpcdn.mddcloud.com.cn:80');
}
//生成随机数
function getRandomid(n){
	let chars = ['0','1','2','3','4','5','6','7','8','9'],
	ids ="";
	if(n === 32) {
		chars = chars.concat(['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z']);
	} else {
		chars = chars.concat(['a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z']);
	}
	for(var i = 0; i < n; i++){
		var id = parseInt(Math.random()*61);
		ids += chars[id];
	}
	return ids;
}
//随机时间
function rahdomTime(min,max){
	var range = max - min;
	var rand = Math.random();
	var tm = min + Math.round(rand * range);
	return tm;
}
//切片
function spiltVideo(n,arr){
    for (let i = 1;(i*10485760) < n;i++) {
        arr.push(i*10485760);
    }
    arr.push(n);
	return arr;
}
chrome.webRequest.onBeforeSendHeaders.addListener(function (details) {
    details.requestHeaders.push({
        name:"Referer",
        value:"mdd"
    });
    details.requestHeaders.push({
        name:"Origin",
        value:"mdd"
    });
    details.requestHeaders.push({
        name:"User-Agent",
        value:`Mdd/${version} (ios 15.4)`
    });
    return {
        requestHeaders: details.requestHeaders
    };
},
    {
        urls: ["http://mob.mddcloud.com.cn/*","https://mob.mddcloud.com.cn/*"]
    },
    ["blocking", "requestHeaders", "extraHeaders"]
);